# æ¶æ„ç¨‹åºæ£€æµ‹ç³»ç»Ÿ - æ¥å£å¯¹æ¥æ–‡æ¡£

## 1. æ–‡æ¡£æ¦‚è¿°

### 1.1 æ–‡æ¡£ç›®çš„
æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜æ¶æ„ç¨‹åºæ£€æµ‹ç³»ç»Ÿçš„æ‰€æœ‰APIæ¥å£è§„èŒƒï¼ŒåŒ…æ‹¬è¯·æ±‚æ ¼å¼ã€å“åº”æ ¼å¼ã€å‚æ•°è¯´æ˜ã€é”™è¯¯ç ç­‰ï¼Œä¾›å‰ç«¯å¼€å‘äººå‘˜å’Œå…¶ä»–ç³»ç»Ÿé›†æˆä½¿ç”¨ã€‚

### 1.2 æ¥å£è§„èŒƒ
- **åè®®ï¼š** HTTP/HTTPS
- **æ•°æ®æ ¼å¼ï¼š** JSON
- **å­—ç¬¦ç¼–ç ï¼š** UTF-8
- **è¯·æ±‚æ–¹æ³•ï¼š** POSTï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰ã€GETï¼ˆæŸ¥è¯¢ï¼‰ã€DELETEï¼ˆåˆ é™¤ï¼‰

### 1.3 åŸºç¡€URL
```
å¼€å‘ç¯å¢ƒï¼šhttp://localhost:8000
ç”Ÿäº§ç¯å¢ƒï¼šhttps://api.example.com
```

### 1.4 é€šç”¨å“åº”æ ¼å¼

**æˆåŠŸå“åº”ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": { ... }
}
```

**é”™è¯¯å“åº”ï¼š**
```json
{
    "code": 400,
    "message": "error message",
    "error": "detailed error information"
}
```

### 1.5 é€šç”¨é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒï¼ˆéœ€è¦ç™»å½•ï¼‰ |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 413 | æ–‡ä»¶è¿‡å¤§ |
| 415 | ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 503 | æœåŠ¡ä¸å¯ç”¨ |

---

## 2. æ–‡ä»¶ä¸Šä¼ æ¥å£

### 2.1 å•æ–‡ä»¶ä¸Šä¼ 

**æ¥å£è·¯å¾„ï¼š** `/api/upload/single`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `multipart/form-data`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | æ˜¯ | ä¸Šä¼ çš„æ–‡ä»¶ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:8000/api/upload/single \
  -F "file=@sample.exe"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "filename": "sample.exe",
        "file_type": "PE",
        "file_size": 1024000,
        "md5": "5d41402abc4b2a76b9719d911017c592",
        "upload_time": "2024-01-01T10:00:00Z",
        "file_path": "/tmp/uploads/550e8400-e29b-41d4-a716-446655440000/sample.exe"
    }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 413,
    "message": "File too large",
    "error": "File size exceeds maximum limit of 100MB"
}
```

---

### 2.2 æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 

**æ¥å£è·¯å¾„ï¼š** `/api/upload/batch`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `multipart/form-data`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| files | File[] | æ˜¯ | ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://localhost:8000/api/upload/batch \
  -F "files=@sample1.exe" \
  -F "files=@sample2.dll" \
  -F "files=@sample3.evtx"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "total": 3,
        "files": [
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440001",
                "filename": "sample1.exe",
                "file_type": "PE",
                "file_size": 1024000,
                "md5": "5d41402abc4b2a76b9719d911017c591",
                "upload_time": "2024-01-01T10:00:00Z"
            },
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440002",
                "filename": "sample2.dll",
                "file_type": "PE",
                "file_size": 512000,
                "md5": "5d41402abc4b2a76b9719d911017c592",
                "upload_time": "2024-01-01T10:00:01Z"
            },
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440003",
                "filename": "sample3.evtx",
                "file_type": "EVTX",
                "file_size": 2048000,
                "md5": "5d41402abc4b2a76b9719d911017c593",
                "upload_time": "2024-01-01T10:00:02Z"
            }
        ]
    }
}
```

---

## 3. æ£€æµ‹æ¥å£

### 3.1 é™æ€æ£€æµ‹æ¥å£

**æ¥å£è·¯å¾„ï¼š** `/api/detection/static`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶IDï¼ˆä»ä¸Šä¼ æ¥å£è·å–ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "file_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "module": "static",
        "status": "success",
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "is_malicious": true,
        "matches": [
            {
                "rule_name": "Trojan_Win32_Generic",
                "rule_id": "TROJAN_001",
                "tags": ["trojan", "windows"],
                "strings": [
                    {
                        "offset": 1024,
                        "value": "malicious_string_1"
                    }
                ],
                "description": "Detects generic trojan behavior"
            }
        ],
        "scan_time": "2024-01-01T10:00:05Z",
        "execution_time_ms": 1250
    }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 500,
    "message": "Detection failed",
    "error": "YARA engine error: Rule compilation failed"
}
```

---

### 3.2 äººå·¥æ™ºèƒ½æ£€æµ‹æ¥å£

**æ¥å£è·¯å¾„ï¼š** `/api/detection/ai`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "file_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "module": "ai",
        "status": "success",
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "is_malicious": true,
        "prediction": {
            "malicious_probability": 0.95,
            "confidence": 0.92,
            "malware_family": "Trojan",
            "family_confidence": 0.88
        },
        "features": {
            "feature_count": 256,
            "top_features": [
                {"name": "suspicious_import", "value": 0.85},
                {"name": "entropy", "value": 7.2}
            ]
        },
        "scan_time": "2024-01-01T10:00:10Z",
        "execution_time_ms": 2100
    }
}
```

---

### 3.3 åŠ¨æ€æ£€æµ‹æ¥å£

**æ¥å£è·¯å¾„ï¼š** `/api/detection/dynamic`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶IDï¼ˆå¿…é¡»æ˜¯EVTXæ–‡ä»¶ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "file_id": "550e8400-e29b-41d4-a716-446655440003"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "module": "dynamic",
        "status": "success",
        "file_id": "550e8400-e29b-41d4-a716-446655440003",
        "is_malicious": true,
        "matches": [
            {
                "rule_id": "SIGMA_001",
                "rule_name": "Suspicious Process Execution",
                "event_id": 4688,
                "timestamp": "2024-01-01T09:30:00Z",
                "details": {
                    "process_name": "cmd.exe",
                    "command_line": "powershell -encodedcommand ..."
                }
            }
        ],
        "statistics": {
            "total_events": 10000,
            "matched_events": 15,
            "matched_rules": 3
        },
        "scan_time": "2024-01-01T10:00:15Z",
        "execution_time_ms": 3500
    }
}
```

---

### 3.4 å•æ ·æœ¬ç»¼åˆæ£€æµ‹æ¥å£

**æ¥å£è·¯å¾„ï¼š** `/api/detection/single`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶ID |
| modules | String[] | æ˜¯ | è¦æ‰§è¡Œçš„æ£€æµ‹æ¨¡å—åˆ—è¡¨ï¼Œå¯é€‰å€¼ï¼š["static", "ai", "dynamic"] |
| enable_internet | Boolean | å¦ | æ˜¯å¦å¯ç”¨LLMè”ç½‘åŠŸèƒ½ï¼Œé»˜è®¤false |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "file_id": "550e8400-e29b-41d4-a716-446655440000",
    "modules": ["static", "ai"],
    "enable_internet": true
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "file_info": {
            "filename": "sample.exe",
            "file_type": "PE",
            "file_size": 1024000,
            "md5": "5d41402abc4b2a76b9719d911017c592"
        },
        "detection_results": [
            {
                "module": "static",
                "status": "success",
                "is_malicious": true,
                "details": { ... }
            },
            {
                "module": "ai",
                "status": "success",
                "is_malicious": true,
                "details": { ... }
            }
        ],
        "final_verdict": {
            "is_malicious": true,
            "confidence": 0.95,
            "reason": "å¤šä¸ªæ£€æµ‹æ¨¡å—å‡åˆ¤å®šä¸ºæ¶æ„"
        },
        "report_id": "report_550e8400-e29b-41d4-a716-446655440000",
        "scan_time": "2024-01-01T10:00:20Z",
        "total_execution_time_ms": 4500
    }
}
```

**æ³¨æ„ï¼š** æ­¤æ¥å£ä¼šä¸²è¡Œæ‰§è¡ŒæŒ‡å®šçš„æ£€æµ‹æ¨¡å—ï¼Œå¹¶æ•´åˆç»“æœã€‚å¦‚æœæŸä¸ªæ¨¡å—æ‰§è¡Œå¤±è´¥ï¼Œä¼šè¿”å›éƒ¨åˆ†ç»“æœã€‚

---

## 4. LLMæŠ¥å‘Šç”Ÿæˆæ¥å£

### 4.1 ç”Ÿæˆåˆ†ææŠ¥å‘Š

**æ¥å£è·¯å¾„ï¼š** `/api/llm/generate-report`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| detection_results | Object | æ˜¯ | æ£€æµ‹ç»“æœæ•°æ®ï¼ˆä»å•æ ·æœ¬ç»¼åˆæ£€æµ‹æ¥å£è·å–ï¼‰ |
| enable_internet | Boolean | æ˜¯ | æ˜¯å¦å¯ç”¨è”ç½‘åŠŸèƒ½ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "detection_results": {
        "file_info": {
            "filename": "sample.exe",
            "file_type": "PE"
        },
        "detection_results": [
            {
                "module": "static",
                "status": "success",
                "is_malicious": true,
                "details": {
                    "matches": [...]
                }
            },
            {
                "module": "ai",
                "status": "success",
                "is_malicious": true,
                "details": {
                    "prediction": {...}
                }
            }
        ],
        "final_verdict": {
            "is_malicious": true,
            "confidence": 0.95
        }
    },
    "enable_internet": true
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "report_id": "report_550e8400-e29b-41d4-a716-446655440000",
        "report_content": "# æ¶æ„ç¨‹åºåˆ†ææŠ¥å‘Š\n\n## 1. æ ·æœ¬åŸºæœ¬ä¿¡æ¯\n\n- **æ–‡ä»¶åï¼š** sample.exe\n- **æ–‡ä»¶ç±»å‹ï¼š** PE\n- **æ–‡ä»¶å¤§å°ï¼š** 1.0 MB\n- **MD5å€¼ï¼š** 5d41402abc4b2a76b9719d911017c592\n\n## 2. å¨èƒç­‰çº§è¯„ä¼°\n\n**å¨èƒç­‰çº§ï¼š** ğŸ”´ é«˜å±\n\n...",
        "report_format": "markdown",
        "generation_time": "2024-01-01T10:00:25Z",
        "execution_time_ms": 8500,
        "llm_provider": "openai",
        "internet_enabled": true
    }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 503,
    "message": "LLM service unavailable",
    "error": "OpenAI API timeout after 60 seconds"
}
```

---

### 4.2 è·å–æŠ¥å‘Šï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰

å¦‚æœæŠ¥å‘Šç”Ÿæˆé‡‡ç”¨å¼‚æ­¥æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ¥å£æŸ¥è¯¢æŠ¥å‘ŠçŠ¶æ€å’Œç»“æœã€‚

**æ¥å£è·¯å¾„ï¼š** `/api/llm/report/{report_id}`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| report_id | String | æ˜¯ | æŠ¥å‘ŠIDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼ˆç”Ÿæˆä¸­ï¼‰ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "report_id": "report_550e8400-e29b-41d4-a716-446655440000",
        "status": "processing",
        "progress": 60,
        "estimated_time_remaining_seconds": 30
    }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆå·²å®Œæˆï¼‰ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "report_id": "report_550e8400-e29b-41d4-a716-446655440000",
        "status": "completed",
        "report_content": "# æ¶æ„ç¨‹åºåˆ†ææŠ¥å‘Š\n\n...",
        "generation_time": "2024-01-01T10:00:25Z"
    }
}
```

---

## 5. æ‰¹é‡æ£€æµ‹æ¥å£

### 5.1 æ‰¹é‡æ£€æµ‹

**æ¥å£è·¯å¾„ï¼š** `/api/detection/batch`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_ids | String[] | æ˜¯ | æ–‡ä»¶IDåˆ—è¡¨ |
| modules | String[] | æ˜¯ | è¦æ‰§è¡Œçš„æ£€æµ‹æ¨¡å—åˆ—è¡¨ï¼Œå¯é€‰å€¼ï¼š["static", "ai"]ï¼ˆæ³¨æ„ï¼šæ‰¹é‡æ¨¡å¼ä¸æ”¯æŒdynamicï¼‰ |
| ground_truth | Object | å¦ | Ground Truthæ•°æ®ï¼ˆç”¨äºæ€§èƒ½è¯„ä¼°ï¼‰ |

**Ground Truthæ ¼å¼ï¼š**
```json
{
    "sample1.exe": 1,
    "sample2.exe": 0,
    "sample3.dll": 1
}
```
å…¶ä¸­ï¼Œ`1`è¡¨ç¤ºæ¶æ„ï¼Œ`0`è¡¨ç¤ºè‰¯æ€§ã€‚

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "file_ids": [
        "550e8400-e29b-41d4-a716-446655440001",
        "550e8400-e29b-41d4-a716-446655440002",
        "550e8400-e29b-41d4-a716-446655440003"
    ],
    "modules": ["static", "ai"],
    "ground_truth": {
        "sample1.exe": 1,
        "sample2.exe": 0,
        "sample3.dll": 1
    }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
        "total_files": 3,
        "results": [
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440001",
                "filename": "sample1.exe",
                "file_type": "PE",
                "detection_results": {
                    "static": { ... },
                    "ai": { ... }
                },
                "final_verdict": {
                    "is_malicious": true,
                    "confidence": 0.92
                }
            },
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440002",
                "filename": "sample2.exe",
                "file_type": "PE",
                "detection_results": {
                    "static": { ... },
                    "ai": { ... }
                },
                "final_verdict": {
                    "is_malicious": false,
                    "confidence": 0.85
                }
            },
            {
                "file_id": "550e8400-e29b-41d4-a716-446655440003",
                "filename": "sample3.dll",
                "file_type": "PE",
                "detection_results": {
                    "static": { ... },
                    "ai": { ... }
                },
                "final_verdict": {
                    "is_malicious": true,
                    "confidence": 0.88
                }
            }
        ],
        "evaluation": {
            "accuracy": 0.67,
            "precision": 1.0,
            "recall": 0.67,
            "false_positive_rate": 0.0,
            "false_negative_rate": 0.33,
            "f1_score": 0.8,
            "confusion_matrix": {
                "true_positive": 2,
                "true_negative": 1,
                "false_positive": 0,
                "false_negative": 1
            },
            "error_files": {
                "false_positive": [],
                "false_negative": ["sample3.dll"]
            }
        },
        "scan_time": "2024-01-01T10:00:30Z",
        "total_execution_time_ms": 15000
    }
}
```

**æ³¨æ„ï¼š** æ‰¹é‡æ£€æµ‹å¯èƒ½è€—æ—¶è¾ƒé•¿ï¼Œå»ºè®®é‡‡ç”¨å¼‚æ­¥æ¨¡å¼ã€‚

---

### 5.2 æ‰¹é‡æ£€æµ‹ï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰

**æ¥å£è·¯å¾„ï¼š** `/api/detection/batch/async`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š** åŒæ‰¹é‡æ£€æµ‹æ¥å£

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
        "status": "queued",
        "total_files": 3,
        "estimated_time_seconds": 60
    }
}
```

---

### 5.3 æŸ¥è¯¢æ‰¹é‡æ£€æµ‹è¿›åº¦

**æ¥å£è·¯å¾„ï¼š** `/api/detection/batch/{task_id}/status`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| task_id | String | æ˜¯ | ä»»åŠ¡IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
        "status": "processing",
        "progress": {
            "current": 2,
            "total": 3,
            "percentage": 66.67,
            "current_file": "sample2.exe"
        },
        "estimated_time_remaining_seconds": 20
    }
}
```

**çŠ¶æ€å€¼è¯´æ˜ï¼š**
- `queued`: æ’é˜Ÿä¸­
- `processing`: å¤„ç†ä¸­
- `completed`: å·²å®Œæˆ
- `failed`: å¤±è´¥

---

### 5.4 è·å–æ‰¹é‡æ£€æµ‹ç»“æœ

**æ¥å£è·¯å¾„ï¼š** `/api/detection/batch/{task_id}/results`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| task_id | String | æ˜¯ | ä»»åŠ¡IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
        "status": "completed",
        "results": [ ... ],
        "evaluation": { ... }
    }
}
```

---

## 6. æ€§èƒ½è¯„ä¼°æ¥å£

### 6.1 æ€§èƒ½è¯„ä¼°

**æ¥å£è·¯å¾„ï¼š** `/api/evaluation/performance`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| detection_results | Object[] | æ˜¯ | æ£€æµ‹ç»“æœåˆ—è¡¨ |
| ground_truth | Object | æ˜¯ | Ground Truthæ•°æ® |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```json
{
    "detection_results": [
        {
            "filename": "sample1.exe",
            "is_malicious": true
        },
        {
            "filename": "sample2.exe",
            "is_malicious": false
        }
    ],
    "ground_truth": {
        "sample1.exe": 1,
        "sample2.exe": 0
    }
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "metrics": {
            "accuracy": 1.0,
            "precision": 1.0,
            "recall": 1.0,
            "false_positive_rate": 0.0,
            "false_negative_rate": 0.0,
            "f1_score": 1.0
        },
        "confusion_matrix": {
            "true_positive": 1,
            "true_negative": 1,
            "false_positive": 0,
            "false_negative": 0
        },
        "error_files": {
            "false_positive": [],
            "false_negative": []
        }
    }
}
```

---

## 7. æ–‡ä»¶ç®¡ç†æ¥å£

### 7.1 åˆ é™¤æ–‡ä»¶

**æ¥å£è·¯å¾„ï¼š** `/api/file/{file_id}`

**è¯·æ±‚æ–¹æ³•ï¼š** `DELETE`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "deleted": true
    }
}
```

---

### 7.2 è·å–æ–‡ä»¶ä¿¡æ¯

**æ¥å£è·¯å¾„ï¼š** `/api/file/{file_id}`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file_id | String | æ˜¯ | æ–‡ä»¶IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "file_id": "550e8400-e29b-41d4-a716-446655440000",
        "filename": "sample.exe",
        "file_type": "PE",
        "file_size": 1024000,
        "md5": "5d41402abc4b2a76b9719d911017c592",
        "upload_time": "2024-01-01T10:00:00Z"
    }
}
```

---

## 8. æŠ¥å‘Šä¸‹è½½æ¥å£

### 8.1 ä¸‹è½½æŠ¥å‘Š

**æ¥å£è·¯å¾„ï¼š** `/api/report/{report_id}/download`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| report_id | String | æ˜¯ | æŠ¥å‘ŠIDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| format | String | å¦ | ä¸‹è½½æ ¼å¼ï¼Œå¯é€‰å€¼ï¼š`markdown`ï¼ˆé»˜è®¤ï¼‰ã€`pdf`ï¼ˆå¦‚æ”¯æŒï¼‰ |

**å“åº”ï¼š**
- Content-Type: `text/markdown` æˆ– `application/pdf`
- Content-Disposition: `attachment; filename="report_{report_id}.md"`

---

## 9. æ‰¹é‡ç»“æœå¯¼å‡ºæ¥å£

### 9.1 å¯¼å‡ºæ‰¹é‡æ£€æµ‹ç»“æœ

**æ¥å£è·¯å¾„ï¼š** `/api/detection/batch/{task_id}/export`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| task_id | String | æ˜¯ | ä»»åŠ¡IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| format | String | å¦ | å¯¼å‡ºæ ¼å¼ï¼Œå¯é€‰å€¼ï¼š`csv`ï¼ˆé»˜è®¤ï¼‰ã€`json`ã€`excel`ï¼ˆå¦‚æ”¯æŒï¼‰ |

**å“åº”ç¤ºä¾‹ï¼ˆCSVæ ¼å¼ï¼‰ï¼š**
```csv
æ–‡ä»¶å,æ–‡ä»¶ç±»å‹,æ£€æµ‹ç»“æœ,é™æ€æ£€æµ‹,AIæ£€æµ‹,æ˜¯å¦ä¸ºæ¶æ„
sample1.exe,PE,æ¶æ„,æ˜¯,æ˜¯,1
sample2.exe,PE,è‰¯æ€§,å¦,å¦,0
```

**å“åº”ç¤ºä¾‹ï¼ˆJSONæ ¼å¼ï¼‰ï¼š**
```json
{
    "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
    "export_time": "2024-01-01T10:05:00Z",
    "results": [ ... ],
    "evaluation": { ... }
}
```

---

## 10. WebSocketæ¥å£ï¼ˆå¯é€‰ï¼‰

### 10.1 å®æ—¶è¿›åº¦æ¨é€

å¦‚æœé‡‡ç”¨WebSocketå®ç°å®æ—¶è¿›åº¦æ¨é€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ¥å£ï¼š

**è¿æ¥åœ°å€ï¼š** `ws://localhost:8000/ws/progress/{task_id}`

**æ¶ˆæ¯æ ¼å¼ï¼š**

**å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼š**
```json
{
    "action": "subscribe",
    "task_id": "task_550e8400-e29b-41d4-a716-446655440000"
}
```

**æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼š**
```json
{
    "type": "progress",
    "task_id": "task_550e8400-e29b-41d4-a716-446655440000",
    "progress": {
        "current": 2,
        "total": 3,
        "percentage": 66.67,
        "current_file": "sample2.exe"
    }
}
```

---

## 11. æ¥å£è°ƒç”¨ç¤ºä¾‹

### 11.1 å•æ ·æœ¬æ£€æµ‹å®Œæ•´æµç¨‹

```javascript
// 1. ä¸Šä¼ æ–‡ä»¶
const uploadResponse = await fetch('/api/upload/single', {
    method: 'POST',
    body: formData
});
const { data: { file_id } } = await uploadResponse.json();

// 2. æ‰§è¡Œæ£€æµ‹
const detectionResponse = await fetch('/api/detection/single', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        file_id: file_id,
        modules: ['static', 'ai'],
        enable_internet: true
    })
});
const { data: detectionResults } = await detectionResponse.json();

// 3. ç”ŸæˆæŠ¥å‘Š
const reportResponse = await fetch('/api/llm/generate-report', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        detection_results: detectionResults,
        enable_internet: true
    })
});
const { data: { report_content } } = await reportResponse.json();

// 4. ä¸‹è½½æŠ¥å‘Š
window.location.href = `/api/report/${detectionResults.report_id}/download`;
```

### 11.2 æ‰¹é‡æ£€æµ‹å®Œæ•´æµç¨‹

```javascript
// 1. æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
const uploadResponse = await fetch('/api/upload/batch', {
    method: 'POST',
    body: formData
});
const { data: { files } } = await uploadResponse.json();
const file_ids = files.map(f => f.file_id);

// 2. å¼€å§‹æ‰¹é‡æ£€æµ‹ï¼ˆå¼‚æ­¥ï¼‰
const batchResponse = await fetch('/api/detection/batch/async', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        file_ids: file_ids,
        modules: ['static', 'ai'],
        ground_truth: {
            'sample1.exe': 1,
            'sample2.exe': 0
        }
    })
});
const { data: { task_id } } = await batchResponse.json();

// 3. è½®è¯¢æŸ¥è¯¢è¿›åº¦
const checkProgress = setInterval(async () => {
    const statusResponse = await fetch(`/api/detection/batch/${task_id}/status`);
    const { data } = await statusResponse.json();
    
    if (data.status === 'completed') {
        clearInterval(checkProgress);
        // è·å–ç»“æœ
        const resultsResponse = await fetch(`/api/detection/batch/${task_id}/results`);
        const { data: results } = await resultsResponse.json();
        console.log(results);
    }
}, 1000);
```

---

## 12. æ¥å£ç‰ˆæœ¬ç®¡ç†

### 12.1 ç‰ˆæœ¬å·è§„èŒƒ
- å½“å‰ç‰ˆæœ¬ï¼š`v1`
- ç‰ˆæœ¬æ ¼å¼ï¼š`/api/v1/...`

### 12.2 ç‰ˆæœ¬å…¼å®¹æ€§
- å‘åå…¼å®¹ï¼šæ–°ç‰ˆæœ¬åº”å…¼å®¹æ—§ç‰ˆæœ¬æ¥å£
- åºŸå¼ƒæ¥å£ï¼šæå‰é€šçŸ¥ï¼Œä¿ç•™è‡³å°‘ä¸€ä¸ªç‰ˆæœ¬å‘¨æœŸ

---

## 13. æ¥å£é™æµ

### 13.1 é™æµè§„åˆ™
- å•æ–‡ä»¶ä¸Šä¼ ï¼š10æ¬¡/åˆ†é’Ÿ
- æ‰¹é‡æ–‡ä»¶ä¸Šä¼ ï¼š5æ¬¡/åˆ†é’Ÿ
- æ£€æµ‹æ¥å£ï¼š20æ¬¡/åˆ†é’Ÿ
- LLMæŠ¥å‘Šç”Ÿæˆï¼š5æ¬¡/åˆ†é’Ÿ

### 13.2 é™æµå“åº”
```json
{
    "code": 429,
    "message": "Too many requests",
    "error": "Rate limit exceeded. Please try again later.",
    "retry_after": 60
}
```

---

## 14. è®¤è¯ä¸æˆæƒï¼ˆåç»­å®ç°ï¼‰

### 14.1 è®¤è¯æ–¹å¼
- JWT Tokenè®¤è¯
- API Keyè®¤è¯

### 14.2 è¯·æ±‚å¤´
```
Authorization: Bearer <token>
```
æˆ–
```
X-API-Key: <api_key>
```

